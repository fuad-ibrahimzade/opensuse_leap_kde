"use strict";__filename="pages/options_defs.js",define(["require","exports","./async_bg","./options_base"],function(t,i,n,s){var r,e,u,h,o,f,a,c,l,v,d,g,p;Object.defineProperty(i,"__esModule",{value:true}),i.onKeyMappingsError=i.createNewOption=i.registerClass=i.savedStatus=i.exportBtn=i.saveBtn=i.xt=i.Nt=i.Mt=i.Ot=i.Tt=i.Et=void 0,s.s.i=Object.create(null),s.s.B=[],s.s.prototype.O=function(t){if(t.call(this),VApi){var i=s.r.k[this.x],r=this.D();n.d(3,{key:i,val:r}).then(function(t){VApi.z[i]=void 0!==t?t:r})}},s.s.Vt=function(){return __awaiter(this,void 0,void 0,function*(){var t,i,r,e,u,h,o=s.s.i,f=[];for(r in s.r.p(),i=(t=o.optionalPermissions)&&t.A(),yield Promise.all([s.r.v(),i]),o)!(e=o[r]).N&&e.Z()&&f.push(e.Ft());if(f.length>0&&!confirm(s.t("dirtyOptions",[f.join("\n  * ")])))return false;for(r in o)if(!(e=o[r]).N&&!e.L())return false;for(r in n.m(4),o.vimSync.N||(yield o.vimSync.A()),o.exclusionRules.N||(yield o.exclusionRules.A()),u=[],o)(h=o[r]).N||u.push(h.A());return yield Promise.all(u),n.m(0,4),true})},s.s.Bt=function(){var t,i=s.s.i;for(t in i)if(!i[t].N)return true;return false},s.s.prototype.Ft=function(){var t=this.b;return this instanceof e?t.nextElementSibling.textContent:(t=(t=t.closest("tr")).querySelector(".caption")).innerText.replace(/[\r\n]/g,"")},s.s.prototype.q=function(t,i){return t===i},r=(function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.P=function(){var t,n,r=this;this.j={min:(t=this.b.min)&&!isNaN(n=parseFloat(t))?n:null,max:(t=this.b.max)&&!isNaN(n=parseFloat(t))?n:null,default:0,H:i.Jt},this.b.oninput=this.w,this.b.onfocus=this.jt.bind(this),s.r.v().then(function(){r.j.default=s.r.l[r.x]})},i.prototype.M=function(t){this.b.value=""+t},i.prototype.D=function(){return parseFloat(this.b.value)},i.prototype.jt=function(){var t=this,i=this.b,n=function(i){return t.At(i)},s=function(){i.removeEventListener("wheel",n,{passive:false}),i.removeEventListener("blur",s),t.Pt=0};this.Pt=0,i.addEventListener("wheel",n,{passive:false}),i.addEventListener("blur",s)},i.prototype.At=function(t){var i,n,s,r,e,u,h,o;if(t.preventDefault(),i=this.Pt,!((n=Date.now())-i<100&&n+99>i&&i))return this.Pt=n,e=(s=this.b).value,"function"==typeof(h=(r=(t.deltaY||t.deltaX)>0)?s.stepUp:s.stepDown)?(h.call(s),u=s.value,s.value=e):(o=(h=parseFloat)(s.step)||1,n=(+s.value||0)+(r?o:-o),isNaN(o=h(s.max))||(n=Math.min(n,o)),isNaN(o=h(s.min))||(n=Math.max(n,o)),u=""+n),this.Rt(u,i>0,false)},i.Jt=function(t){return isNaN(t)&&(t=this.default),t=null!=this.min?Math.max(this.min,t):t,null!=this.max?Math.min(this.max,t):t},i})(s.s),i.Et=r,e=(function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.P=function(){var t=this.b,n=t.dataset.map;this.Ut=n?JSON.parse(n):t.dataset.allowNull?i.Dt:i.Ht,this.Lt=this.Ut.length-1,this.Lt>1&&"vimSync"!==this.x&&t.addEventListener("change",this.onTripleStatusesClicked.bind(this),true),t.onchange=this.w},i.prototype.M=function(t){var i=true===t||t===this.Ut[this.Lt];this.b.checked=i,this.b.indeterminate=this.Lt>1&&t===this.Ut[1],this.qt=i?this.Lt:Math.max(0,this.Ut.indexOf(t))},i.prototype.D=function(){return this.b.indeterminate?this.Ut[1]:this.Ut[this.b.checked?this.Lt:0]},i.prototype.onTripleStatusesClicked=function(t){t.preventDefault();var i=this.qt;this.qt=2===i?1:i?0:2,this.b.indeterminate=2===i,this.b.checked=2===this.qt},i.Ht=[false,true],i.Dt=[false,null,true],i})(s.s),i.Tt=e,u=(function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.Ct=false,i}return __extends(i,t),i.prototype.P=function(){var t=this.b.dataset.converter||"",n=t?t.split(" "):[];this.b.oninput=this.w,n.length>0&&(this.j={It:n,$:0,H:i.zt})},i.prototype.J=function(){var i=this,n=t.prototype.J.call(this),s=this.j;return s&&(s.$=0,n?n=n.then(function(){s.$=s.H(i.S)===i.S?1:0}):s.$=s.H(this.S)===this.S?1:0),n},i.prototype.M=function(t,i){var n=this.Gt(t).replace(/ /g,"\xa0");true!==i?this.b.value=n:this.Rt(n,true,true)},i.prototype.Kt=function(){return this.b.value.trim().replace(/\xa0/g," ")},i.prototype.Gt=function(t){return t},i.prototype.D=function(){var t=this.Kt(),n=this.j;return t&&n&&n.H===i.zt&&(n.$|=2,t=i.zt.call(n,t),n.$&=-3),t},i.prototype.F=function(t){return this.Gt(t)!==this.Kt()},i.prototype.bt=function(t,n){var s=!!t;(s||this.Ct)&&(this.Ct=s,i.bt(t,n,this.b))},i.bt=function(t,i,s){var r=!!t,e=s.classList,u=s.parentElement,h=s.nextElementSibling;h=h&&h.classList.contains("tip")?h:null,(r||h)&&n.K(function(){r?(null==h&&((h=document.createElement("div")).className="tip",u.insertBefore(h,s.nextElementSibling)),h.textContent=t,null!==i&&e.add(i||"has-error")):(e.remove("has-error"),e.remove("highlight"),h&&h.remove())})},i.zt=function(t){var i,n,s=this.It;if(s.indexOf("lower")>=0?t=t.toUpperCase().toLowerCase():s.indexOf("upper")>=0&&(t=t.toLowerCase().toUpperCase()),t=t.normalize(),s.indexOf("chars")<0||2&this.$&&!(1&this.$))return t;for(n of(i="",t.replace(/\s/g,"")))i.includes(n)||(i+=n);return i},i})(s.s),i.Ot=u,h=(function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.D=function(){var i=t.prototype.D.call(this);return i||this.M(i=s.r.l[this.x],true),i},i})(u),i.Mt=h,o=(function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.Gt=function(t){var i=this.b instanceof HTMLInputElement,n=JSON.stringify(t,null,i?1:2);return i?n.replace(/(,?)\n\s*/g,function(t,i){return i?", ":""}):n},i.prototype.D=function(){var i=t.prototype.D.call(this),n=null;if(i)try{n=JSON.parse(i)}catch(t){}else this.M(n=s.r.l[this.x],true);return n},i})(u),i.Nt=o,f=(function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.P=function(){t.prototype.P.call(this),this.Qt=true,this.Wt=this.Xt.bind(this),this.b.addEventListener("focus",this.Wt)},i.prototype.Xt=function(){this.Wt&&(this.b.removeEventListener("focus",this.Wt),this.b.classList.remove("masked"),this.Wt=null,this.Qt=false,this.b.removeAttribute("placeholder"),this.J())},i.prototype.M=function(i,n){this.Qt?this.b.placeholder=s.t("clickToUnmask"):t.prototype.M.call(this,i,n)},i.prototype.Kt=function(){return this.Qt?this.S:t.prototype.Kt.call(this)},i})(u),i.xt=f,u.prototype.Rt=r.prototype.Rt=function(t,i,n){var s=false;i&&(this.Yt=true,(s=document.activeElement!==this.b)&&this.b.focus(),document.execCommand("undo")),this.Yt=n,this.b.select(),document.execCommand("insertText",false,t),s&&this.b.blur(),this.Yt=false},o.prototype.q=s.s.G,s.e.prototype.tt=function(t){var i,r,e,u,h;if(this.U.length===t)for(e of(i=n.$("#exclusionToolbar"),r=n.$$("[data-model]",i),i.style.visibility=t?"":"hidden",r))(h=(u=s.s.i[e.id]).b.parentNode.style).visibility=t||u.N?"":"visible",h.display=!t&&u.N?"none":""},i.saveBtn=n.$("#saveOptions"),i.exportBtn=n.$("#exportButton"),i.createNewOption=(function(){var t,a,c,l,v=false;for(l of(i.savedStatus=function(t){return v=null!=t?t:v},t=function(){this.Yt||((this.N=this.q(this.D(),this.S))?v&&!s.s.Bt()&&(i.saveBtn.disabled=true,i.saveBtn.firstChild.data=s.t("o115"),i.exportBtn.disabled=false,i.savedStatus(false),window.onbeforeunload=null):v||(window.onbeforeunload=function(){return s.t("beforeUnload")},i.savedStatus(true),i.saveBtn.disabled=false,i.saveBtn.firstChild.data=s.t("o115_2"),i.exportBtn.disabled=true))},a={Number:r,Boolean:e,Text:u,NonEmptyText:h,JSON:o,MaskedText:f,ExclusionRules:s.e},c=function(i){var n=new(0,a[i.dataset.model])(i,t);return s.s.i[n.x]=n},s.s.R=true,n.$$("[data-model]")))c(l);return i.registerClass=function(t,i){a[t]=i},c})(),(c=(a=s.s.i.exclusionRules).Q).ondragstart=function(t){(a.Zt=t.target).style.opacity="0.5"},c.ondragend=function(){var t=a.Zt;a.Zt=null,t&&(t.style.opacity="")},c.ondragover=function(t){t.preventDefault()},c.ondrop=function(t){var i,n,s,r,e;t.preventDefault(),i=a.Zt,n=(n=t.target).closest(".exclusionRule"),i&&n&&i!==n&&(a.Q.insertBefore(i,n),s=a.U,r=i.querySelector(".pattern").vnode,e=n.querySelector(".pattern").vnode,s.splice(s.indexOf(r),1),s.splice(s.indexOf(e),0,r),a.w())};v=function(t){for(var i,n,s=new RegExp("^".concat("#").concat("!","[^\\n]*|^[^]"),"gm");i=s.exec(t);)if((n=i[0])&&"\n"!==n[0]){if("#"!==n[0])break;if("!"===n[1]&&"no-check"===n.slice(2).trim()){t=t.slice(0,i.index)+t.slice(i.index+n.length).trimLeft();break}}return t.replace(/\.activateMode(?:To)?/g,".activate")},(l=s.s.i.keyMappings).C=function(){var t=s.s.prototype.C.call(this);return t instanceof Promise?t.then(v):v(t)},l.T=function(t){return t=v(t),s.s.prototype.T.call(this,t)},i.onKeyMappingsError=function(t){true===t?l.bt(s.t("ignoredNonEN"),null):l.bt(t)},n.d(7).then(i.onKeyMappingsError),p=s.s.i.filterLinkHints,(d=s.s.i.linkHintCharacters).z=(g=s.s.i.linkHintNumbers).z=function(){this.bt(!this.b.style.display&&this.S.length<4?n.$t("96"):"")},p.z=function(){n.K(function(t){var i=p.D();t.style.display=g.b.style.display=i?"":"none",d.b.style.display=i?"none":"",d.z(),g.z()},n.$("#waitForEnterBox"))},s.s.i.ignoreKeyboardLayout.z=function(){var t=this;n.K(function(i){i.style.display=t.D()>1?"none":""},n.$("#ignoreCapsLockBox"))},s.s.i.vomnibarPage.z=function(){var t=this.b,i=this.S,r=i.startsWith(location.protocol)||i.startsWith("front/");if(n.pt<50)return n.K(function(){t.style.textDecoration=r?"":"line-through"}),this.bt(i===s.r.l.vomnibarPage?"":s.t("onlyExtVomnibar",[50]),null);r?this.bt(""):i.startsWith("file:")?this.bt(s.t("fileVomnibar"),"highlight"):/^http:\/\/(?!localhost[:/])/i.test(i)?this.bt(s.t("httpVomnibar"),"highlight"):this.bt("")},s.s.i.userDefinedCss.z=function(){var t=this;this.b.classList.contains("debugging")&&n.K(function(){var i,s,r,e=VApi.y().r;for(i of n.$$("iframe",e))s=i.classList.contains("HUD"),(r=i.contentDocument.querySelector("style.debugged"))&&(s?r.remove():r.classList.remove("debugged"));t.b.classList.remove("debugging")})},s.s.i.autoReduceMotion.z=function(){var t=this;n.K(function(){n.toggleReduceMotion(t.S)})},s.s.i.passEsc.D=function(){return h.prototype.D.call(this).replace(/, /g,",")},s.s.i.passEsc.Gt=function(t){return t.replace(/,/g,", ")}});